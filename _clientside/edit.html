<!-- this page is for document editing function test -->
<!-- and still in progress -->

<!DOCTYPE html>
<html lang="en">
<head>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <meta charset="UTF-8">
    <title>edit.html</title>
    <script>
    // toggle text contentEditable attribute
    function tg(btn){
        if (tx.contentEditable == "true") {
            tx.contentEditable = "false";
            btn.innerHTML = "Edit";
            test();
        } else {
            tx.contentEditable = "true";
            //if user click edit button, automatically focus on document
            tx.focus();
            btn.innerHTML = "Hold";
        }
    }
    function test(){
        alert("test");
        var lnk = document.createElement("a");
        var ta = document.createTextNode("a");
        var tb = document.createTextNode("b");
        var tc = document.createTextNode("c");
        var ba = document.createTextNode("||");

        lnk.href ="https://www.google.co.kr";
        lnk.innerHTML="this is a link";
        tx.appendChild(ta);
        tx.appendChild(tb);
        tx.appendChild(tc);
        tx.appendChild(lnk);
        tx.insertBefore(ba, tx.childNodes[1]);
    }
    </script>
</head>
<body>
    <header>

    </header>
    <section>
        <button onclick="tg(this)">Edit</button>
        <div id='text' contentEditable='false' tabindex = '1'></div><br>
        <div id='test' contentEditable='false'></div><br>
        <div id='ca' contentEditable='true' tabindex ='0'>aaaaaaaaaaaa</div>
    </section>
    <footer>

    </footer>
</body>
</html>

<!-- get DOM objects -->
<script>
var tx = document.getElementById("text");
var ts = document.getElementById("test");
var ca = document.getElementById("ca");
</script>

<script>
//global savedrange variable to store text range in
var savedrange = null;

function getSelection()
{
    var savedRange;
    if(window.getSelection && window.getSelection().rangeCount > 0) //FF,Chrome,Opera,Safari,IE9+
    {
        savedRange = window.getSelection().getRangeAt(0).cloneRange();
    }
    return savedRange;
}

// function ck( event ){
//     alert("keyup");
//     var currentRange = getSelection();
//     if(window.getSelection)
//     {
//         ca.innerHTML = currentRange+"";
//         //do stuff with standards based object
//
//     }
// }
$('#text').keyup(function(e) {
    alert("keyup");
    var currentRange = getSelection();
    if(window.getSelection)
    {
        ca.innerHTML = currentRange+"";
        //do stuff with standards based object
    }
});
// https://developer.mozilla.org/en-US/docs/Web/API/range
// http://stackoverflow.com/questions/3972014/get-caret-position-in-contenteditable-div
</script>
